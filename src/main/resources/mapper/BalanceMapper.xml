<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tuum.account.service.mapper.BalanceMapper">

  <insert id="insertBalance" useGeneratedKeys="true" keyProperty="balanceId" keyColumn="balance_id">
    INSERT INTO balance (account_id, available_amount, currency)
    VALUES (#{accountId}, #{availableAmount}, #{currency}::currency_enum)
  </insert>

  <resultMap id="BalanceResult" type="com.tuum.account.service.domain.Balance">
    <id property="balanceId" column="balance_id"/>
    <result property="accountId" column="account_id"/>
    <result property="availableAmount" column="available_amount"/>
    <result property="currency" column="currency"/>
  </resultMap>

  <select id="findByAccountId" resultMap="BalanceResult">
    SELECT balance_id, account_id, available_amount, currency
    FROM balance
    WHERE account_id = #{accountId}
  </select>

  <update id="updateBalance">
    UPDATE balance
    SET available_amount = #{availableAmount}
    WHERE account_id = #{accountId} AND currency = #{currency}::currency_enum
  </update>

</mapper>
